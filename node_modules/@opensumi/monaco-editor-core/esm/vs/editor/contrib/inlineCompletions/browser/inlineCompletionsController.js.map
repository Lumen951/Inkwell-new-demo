{"version":3,"sources":["vs/editor/contrib/inlineCompletions/browser/inlineCompletionsController.ts"],"names":[],"mappings":"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","file":"inlineCompletionsController.js","sourceRoot":"file:///workspaces/monaco-editor-core/out-editor-esm","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { createStyleSheet2 } from '../../../../base/browser/dom';\nimport { alert } from '../../../../base/browser/ui/aria/aria';\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle';\nimport { IObservable, ITransaction, autorun, autorunHandleChanges, constObservable, derived, disposableObservableValue, observableFromEvent, observableSignal, observableValue, transaction } from '../../../../base/common/observable';\nimport { CoreEditingCommands } from '../../../browser/coreCommands';\nimport { ICodeEditor } from '../../../browser/editorBrowser';\nimport { EditorOption } from '../../../common/config/editorOptions';\nimport { Position } from '../../../common/core/position';\nimport { Range } from '../../../common/core/range';\nimport { CursorChangeReason } from '../../../common/cursorEvents';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures';\nimport { IModelContentChangedEvent } from '../../../common/textModelEvents';\nimport { inlineSuggestCommitId } from './commandIds';\nimport { GhostTextWidget } from './ghostTextWidget';\nimport { InlineCompletionContextKeys } from './inlineCompletionContextKeys';\nimport { InlineCompletionsHintsWidget, InlineSuggestionHintsContentWidget } from './inlineCompletionsHintsWidget';\nimport { InlineCompletionsModel, VersionIdChangeReason } from './inlineCompletionsModel';\nimport { SuggestWidgetAdaptor } from './suggestWidgetInlineCompletionProvider';\nimport { localize } from '../../../../nls';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../platform/accessibilitySignal/browser/accessibilitySignalService';\nimport { ICommandService } from '../../../../platform/commands/common/commands';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding';\nimport { mapObservableArrayCached } from '../../../../base/common/observableInternal/utils';\nimport { ISettableObservable } from '../../../../base/common/observableInternal/base';\n\nexport class InlineCompletionsController extends Disposable {\n\tstatic ID = 'editor.contrib.inlineCompletionsController';\n\n\tpublic static get(editor: ICodeEditor): InlineCompletionsController | null {\n\t\treturn editor.getContribution<InlineCompletionsController>(InlineCompletionsController.ID);\n\t}\n\n\tpublic readonly model = this._register(disposableObservableValue<InlineCompletionsModel | undefined>('inlineCompletionModel', undefined));\n\tprivate readonly _textModelVersionId = observableValue<number, VersionIdChangeReason>(this, -1);\n\tprivate readonly _positions = observableValue<readonly Position[]>(this, [new Position(1, 1)]);\n\tprivate readonly _suggestWidgetAdaptor = this._register(new SuggestWidgetAdaptor(\n\t\tthis.editor,\n\t\t() => this.model.get()?.selectedInlineCompletion.get()?.toSingleTextEdit(undefined),\n\t\t(tx) => this.updateObservables(tx, VersionIdChangeReason.Other),\n\t\t(item) => {\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description InlineCompletionsController.handleSuggestAccepted */\n\t\t\t\tthis.updateObservables(tx, VersionIdChangeReason.Other);\n\t\t\t\tthis.model.get()?.handleSuggestAccepted(item);\n\t\t\t});\n\t\t}\n\t));\n\tprivate readonly _enabled = observableFromEvent(this.editor.onDidChangeConfiguration, () => this.editor.getOption(EditorOption.inlineSuggest).enabled);\n\tprivate readonly _fontFamily = observableFromEvent(this.editor.onDidChangeConfiguration, () => this.editor.getOption(EditorOption.inlineSuggest).fontFamily);\n\n\tprivate readonly _ghostTexts = derived(this, (reader) => {\n\t\tconst model = this.model.read(reader);\n\t\treturn model?.ghostTexts.read(reader) ?? [];\n\t});\n\n\tprivate readonly _stablizedGhostTexts = convertItemsToStableObservables(this._ghostTexts, this._store);\n\n\tprivate readonly _ghostTextWidgets = mapObservableArrayCached(this, this._stablizedGhostTexts, (ghostText, store) => {\n\t\treturn store.add(this._instantiationService.createInstance(GhostTextWidget, this.editor, {\n\t\t\tghostText: ghostText,\n\t\t\tminReservedLineCount: constObservable(0),\n\t\t\ttargetTextModel: this.model.map(v => v?.textModel),\n\t\t}));\n\t}).recomputeInitiallyAndOnChange(this._store);\n\n\tprivate readonly _debounceValue = this._debounceService.for(\n\t\tthis._languageFeaturesService.inlineCompletionsProvider,\n\t\t'InlineCompletionsDebounce',\n\t\t{ min: 50, max: 50 }\n\t);\n\n\tprivate readonly _playAccessibilitySignal = observableSignal(this);\n\n\tprivate readonly _isReadonly = observableFromEvent(this.editor.onDidChangeConfiguration, () => this.editor.getOption(EditorOption.readOnly));\n\tprivate readonly _textModel = observableFromEvent(this.editor.onDidChangeModel, () => this.editor.getModel());\n\tprivate readonly _textModelIfWritable = derived(reader => this._isReadonly.read(reader) ? undefined : this._textModel.read(reader));\n\n\tconstructor(\n\t\tpublic readonly editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@ILanguageFeatureDebounceService private readonly _debounceService: ILanguageFeatureDebounceService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(new InlineCompletionContextKeys(this._contextKeyService, this.model));\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description InlineCompletionsController.update model */\n\t\t\tconst textModel = this._textModelIfWritable.read(reader);\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description InlineCompletionsController.onDidChangeModel/readonly */\n\t\t\t\tthis.model.set(undefined, tx);\n\t\t\t\tthis.updateObservables(tx, VersionIdChangeReason.Other);\n\n\t\t\t\tif (textModel) {\n\t\t\t\t\tconst model = _instantiationService.createInstance(\n\t\t\t\t\t\tInlineCompletionsModel,\n\t\t\t\t\t\ttextModel,\n\t\t\t\t\t\tthis._suggestWidgetAdaptor.selectedItem,\n\t\t\t\t\t\tthis._textModelVersionId,\n\t\t\t\t\t\tthis._positions,\n\t\t\t\t\t\tthis._debounceValue,\n\t\t\t\t\t\tobservableFromEvent(editor.onDidChangeConfiguration, () => editor.getOption(EditorOption.suggest).preview),\n\t\t\t\t\t\tobservableFromEvent(editor.onDidChangeConfiguration, () => editor.getOption(EditorOption.suggest).previewMode),\n\t\t\t\t\t\tobservableFromEvent(editor.onDidChangeConfiguration, () => editor.getOption(EditorOption.inlineSuggest).mode),\n\t\t\t\t\t\tthis._enabled,\n\t\t\t\t\t);\n\t\t\t\t\tthis.model.set(model, tx);\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tconst styleElement = this._register(createStyleSheet2());\n\t\tthis._register(autorun(reader => {\n\t\t\tconst fontFamily = this._fontFamily.read(reader);\n\t\t\tstyleElement.setStyle(fontFamily === '' || fontFamily === 'default' ? `` : `\n.monaco-editor .ghost-text-decoration,\n.monaco-editor .ghost-text-decoration-preview,\n.monaco-editor .ghost-text {\n\tfont-family: ${fontFamily};\n}`);\n\t\t}));\n\n\t\tconst getReason = (e: IModelContentChangedEvent): VersionIdChangeReason => {\n\t\t\tif (e.isUndoing) { return VersionIdChangeReason.Undo; }\n\t\t\tif (e.isRedoing) { return VersionIdChangeReason.Redo; }\n\t\t\tif (this.model.get()?.isAcceptingPartially) { return VersionIdChangeReason.AcceptWord; }\n\t\t\treturn VersionIdChangeReason.Other;\n\t\t};\n\t\tthis._register(editor.onDidChangeModelContent((e) => transaction(tx =>\n\t\t\t/** @description InlineCompletionsController.onDidChangeModelContent */\n\t\t\tthis.updateObservables(tx, getReason(e))\n\t\t)));\n\n\t\tthis._register(editor.onDidChangeCursorPosition(e => transaction(tx => {\n\t\t\t/** @description InlineCompletionsController.onDidChangeCursorPosition */\n\t\t\tthis.updateObservables(tx, VersionIdChangeReason.Other);\n\t\t\tif (e.reason === CursorChangeReason.Explicit || e.source === 'api') {\n\t\t\t\tthis.model.get()?.stop(tx);\n\t\t\t}\n\t\t})));\n\n\t\tthis._register(editor.onDidType(() => transaction(tx => {\n\t\t\t/** @description InlineCompletionsController.onDidType */\n\t\t\tthis.updateObservables(tx, VersionIdChangeReason.Other);\n\t\t\tif (this._enabled.get()) {\n\t\t\t\tthis.model.get()?.trigger(tx);\n\t\t\t}\n\t\t})));\n\n\t\tthis._register(this._commandService.onDidExecuteCommand((e) => {\n\t\t\t// These commands don't trigger onDidType.\n\t\t\tconst commands = new Set([\n\t\t\t\tCoreEditingCommands.Tab.id,\n\t\t\t\tCoreEditingCommands.DeleteLeft.id,\n\t\t\t\tCoreEditingCommands.DeleteRight.id,\n\t\t\t\tinlineSuggestCommitId,\n\t\t\t\t'acceptSelectedSuggestion',\n\t\t\t]);\n\t\t\tif (commands.has(e.commandId) && editor.hasTextFocus() && this._enabled.get()) {\n\t\t\t\ttransaction(tx => {\n\t\t\t\t\t/** @description onDidExecuteCommand */\n\t\t\t\t\tthis.model.get()?.trigger(tx);\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(this.editor.onDidBlurEditorWidget(() => {\n\t\t\t// This is a hidden setting very useful for debugging\n\t\t\tif (this._contextKeyService.getContextKeyValue<boolean>('accessibleViewIsShown') || this._configurationService.getValue('editor.inlineSuggest.keepOnBlur') ||\n\t\t\t\teditor.getOption(EditorOption.inlineSuggest).keepOnBlur) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (InlineSuggestionHintsContentWidget.dropDownVisible) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description InlineCompletionsController.onDidBlurEditorWidget */\n\t\t\t\tthis.model.get()?.stop(tx);\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\t/** @description InlineCompletionsController.forceRenderingAbove */\n\t\t\tconst state = this.model.read(reader)?.state.read(reader);\n\t\t\tif (state?.suggestItem) {\n\t\t\t\tif (state.primaryGhostText.lineCount >= 2) {\n\t\t\t\t\tthis._suggestWidgetAdaptor.forceRenderingAbove();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._suggestWidgetAdaptor.stopForceRenderingAbove();\n\t\t\t}\n\t\t}));\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis._suggestWidgetAdaptor.stopForceRenderingAbove();\n\t\t}));\n\n\t\tlet lastInlineCompletionId: string | undefined = undefined;\n\t\tthis._register(autorunHandleChanges({\n\t\t\thandleChange: (context, changeSummary) => {\n\t\t\t\tif (context.didChange(this._playAccessibilitySignal)) {\n\t\t\t\t\tlastInlineCompletionId = undefined;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t}, async reader => {\n\t\t\t/** @description InlineCompletionsController.playAccessibilitySignalAndReadSuggestion */\n\t\t\tthis._playAccessibilitySignal.read(reader);\n\n\t\t\tconst model = this.model.read(reader);\n\t\t\tconst state = model?.state.read(reader);\n\t\t\tif (!model || !state || !state.inlineCompletion) {\n\t\t\t\tlastInlineCompletionId = undefined;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (state.inlineCompletion.semanticId !== lastInlineCompletionId) {\n\t\t\t\tlastInlineCompletionId = state.inlineCompletion.semanticId;\n\t\t\t\tconst lineText = model.textModel.getLineContent(state.primaryGhostText.lineNumber);\n\t\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.inlineSuggestion).then(() => {\n\t\t\t\t\tif (this.editor.getOption(EditorOption.screenReaderAnnounceInlineSuggestion)) {\n\t\t\t\t\t\tthis.provideScreenReaderUpdate(state.primaryGhostText.renderForScreenReader(lineText));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(new InlineCompletionsHintsWidget(this.editor, this.model, this._instantiationService));\n\t\tthis._register(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration('accessibility.verbosity.inlineCompletions')) {\n\t\t\t\tthis.editor.updateOptions({ inlineCompletionsAccessibilityVerbose: this._configurationService.getValue('accessibility.verbosity.inlineCompletions') });\n\t\t\t}\n\t\t}));\n\t\tthis.editor.updateOptions({ inlineCompletionsAccessibilityVerbose: this._configurationService.getValue('accessibility.verbosity.inlineCompletions') });\n\t}\n\n\tpublic playAccessibilitySignal(tx: ITransaction) {\n\t\tthis._playAccessibilitySignal.trigger(tx);\n\t}\n\n\tprivate provideScreenReaderUpdate(content: string): void {\n\t\tconst accessibleViewShowing = this._contextKeyService.getContextKeyValue<boolean>('accessibleViewIsShown');\n\t\tconst accessibleViewKeybinding = this._keybindingService.lookupKeybinding('editor.action.accessibleView');\n\t\tlet hint: string | undefined;\n\t\tif (!accessibleViewShowing && accessibleViewKeybinding && this.editor.getOption(EditorOption.inlineCompletionsAccessibilityVerbose)) {\n\t\t\thint = localize('showAccessibleViewHint', \"Inspect this in the accessible view ({0})\", accessibleViewKeybinding.getAriaLabel());\n\t\t}\n\t\thint ? alert(content + ', ' + hint) : alert(content);\n\t}\n\n\t/**\n\t * Copies over the relevant state from the text model to observables.\n\t * This solves all kind of eventing issues, as we make sure we always operate on the latest state,\n\t * regardless of who calls into us.\n\t */\n\tprivate updateObservables(tx: ITransaction, changeReason: VersionIdChangeReason): void {\n\t\tconst newModel = this.editor.getModel();\n\t\tthis._textModelVersionId.set(newModel?.getVersionId() ?? -1, tx, changeReason);\n\t\tthis._positions.set(this.editor.getSelections()?.map(selection => selection.getPosition()) ?? [new Position(1, 1)], tx);\n\t}\n\n\tpublic shouldShowHoverAt(range: Range) {\n\t\tconst ghostText = this.model.get()?.primaryGhostText.get();\n\t\tif (ghostText) {\n\t\t\treturn ghostText.parts.some(p => range.containsPosition(new Position(ghostText.lineNumber, p.column)));\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic shouldShowHoverAtViewZone(viewZoneId: string): boolean {\n\t\treturn this._ghostTextWidgets.get()[0]?.ownsViewZone(viewZoneId) ?? false;\n\t}\n\n\tpublic hide() {\n\t\ttransaction(tx => {\n\t\t\tthis.model.get()?.stop(tx);\n\t\t});\n\t}\n}\n\nfunction convertItemsToStableObservables<T>(items: IObservable<readonly T[]>, store: DisposableStore): IObservable<IObservable<T>[]> {\n\tconst result = observableValue<IObservable<T>[]>('result', []);\n\tconst innerObservables: ISettableObservable<T>[] = [];\n\n\tstore.add(autorun(reader => {\n\t\tconst itemsValue = items.read(reader);\n\n\t\ttransaction(tx => {\n\t\t\tif (itemsValue.length !== innerObservables.length) {\n\t\t\t\tinnerObservables.length = itemsValue.length;\n\t\t\t\tfor (let i = 0; i < innerObservables.length; i++) {\n\t\t\t\t\tif (!innerObservables[i]) {\n\t\t\t\t\t\tinnerObservables[i] = observableValue<T>('item', itemsValue[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tresult.set([...innerObservables], tx);\n\t\t\t}\n\t\t\tinnerObservables.forEach((o, i) => o.set(itemsValue[i], tx));\n\t\t});\n\t}));\n\n\treturn result;\n}\n"]}