{"version":3,"sources":["file:///workspaces/monaco-editor-core/out-editor-esm/vs/editor/browser/widget/multiDiffEditorWidget/multiDiffEditorWidgetImpl.ts","vs/editor/browser/widget/multiDiffEditorWidget/multiDiffEditorWidgetImpl.ts"],"names":[],"mappings":"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","file":"multiDiffEditorWidgetImpl.js","sourceRoot":"file:///workspaces/monaco-editor-core/out-editor-esm","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension, getWindow, h, scheduleAtNextAnimationFrame } from '../../../../base/browser/dom';\nimport { SmoothScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement';\nimport { findFirstMaxBy } from '../../../../base/common/arraysFind';\nimport { Disposable, IReference, toDisposable } from '../../../../base/common/lifecycle';\nimport { IObservable, IReader, autorun, autorunWithStore, derived, derivedObservableWithCache, derivedWithStore, observableFromEvent, observableValue } from '../../../../base/common/observable';\nimport { ITransaction, disposableObservableValue, globalTransaction, transaction } from '../../../../base/common/observableInternal/base';\nimport { Scrollable, ScrollbarVisibility } from '../../../../base/common/scrollable';\nimport { URI } from '../../../../base/common/uri';\nimport './style.css';\nimport { ICodeEditor } from '../../editorBrowser';\nimport { ObservableElementSizeObserver } from '../diffEditor/utils';\nimport { RevealOptions } from './multiDiffEditorWidget';\nimport { IWorkbenchUIElementFactory } from './workbenchUIElementFactory';\nimport { OffsetRange } from '../../../common/core/offsetRange';\nimport { IRange } from '../../../common/core/range';\nimport { ISelection, Selection } from '../../../common/core/selection';\nimport { IDiffEditor } from '../../../common/editorCommon';\nimport { EditorContextKeys } from '../../../common/editorContextKeys';\nimport { ContextKeyValue, IContextKeyService } from '../../../../platform/contextkey/common/contextkey';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection';\nimport { DiffEditorItemTemplate, TemplateData } from './diffEditorItemTemplate';\nimport { DocumentDiffItemViewModel, MultiDiffEditorViewModel } from './multiDiffEditorViewModel';\nimport { ObjectPool } from './objectPool';\n\nexport class MultiDiffEditorWidgetImpl extends Disposable {\n\tprivate readonly _elements = h('div.monaco-component.multiDiffEditor', [\n\t\th('div@content', {\n\t\t\tstyle: {\n\t\t\t\toverflow: 'hidden',\n\t\t\t}\n\t\t}),\n\t\th('div.monaco-editor@overflowWidgetsDomNode', {\n\t\t}),\n\t]);\n\n\tprivate readonly _sizeObserver = this._register(new ObservableElementSizeObserver(this._element, undefined));\n\n\tprivate readonly _objectPool = this._register(new ObjectPool<TemplateData, DiffEditorItemTemplate>((data) => {\n\t\tconst template = this._instantiationService.createInstance(\n\t\t\tDiffEditorItemTemplate,\n\t\t\tthis._elements.content,\n\t\t\tthis._elements.overflowWidgetsDomNode,\n\t\t\tthis._workbenchUIElementFactory\n\t\t);\n\t\ttemplate.setData(data);\n\t\treturn template;\n\t}));\n\n\tprivate readonly _scrollable = this._register(new Scrollable({\n\t\tforceIntegerValues: false,\n\t\tscheduleAtNextAnimationFrame: (cb) => scheduleAtNextAnimationFrame(getWindow(this._element), cb),\n\t\tsmoothScrollDuration: 100,\n\t}));\n\n\tprivate readonly _scrollableElement = this._register(new SmoothScrollableElement(this._elements.root, {\n\t\tvertical: ScrollbarVisibility.Auto,\n\t\thorizontal: ScrollbarVisibility.Auto,\n\t\tuseShadows: false,\n\t}, this._scrollable));\n\n\tpublic readonly scrollTop = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollTop */ this._scrollableElement.getScrollPosition().scrollTop);\n\tpublic readonly scrollLeft = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollLeft */ this._scrollableElement.getScrollPosition().scrollLeft);\n\n\tprivate readonly _viewItems = derivedWithStore<readonly VirtualizedViewItem[]>(this,\n\t\t(reader, store) => {\n\t\t\tconst vm = this._viewModel.read(reader);\n\t\t\tif (!vm) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst items = vm.items.read(reader);\n\t\t\treturn items.map(d => {\n\t\t\t\tconst item = store.add(new VirtualizedViewItem(d, this._objectPool, this.scrollLeft, delta => {\n\t\t\t\t\tthis._scrollableElement.setScrollPosition({ scrollTop: this._scrollableElement.getScrollPosition().scrollTop + delta });\n\t\t\t\t}));\n\t\t\t\tconst data = this._lastDocStates?.[item.getKey()];\n\t\t\t\tif (data) {\n\t\t\t\t\ttransaction(tx => {\n\t\t\t\t\t\titem.setViewState(data, tx);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn item;\n\t\t\t});\n\t\t}\n\t);\n\n\tprivate readonly _spaceBetweenPx = 0;\n\n\tprivate readonly _totalHeight = this._viewItems.map(this, (items, reader) => items.reduce((r, i) => r + i.contentHeight.read(reader) + this._spaceBetweenPx, 0));\n\tpublic readonly activeDiffItem = derived(this, reader => this._viewItems.read(reader).find(i => i.template.read(reader)?.isFocused.read(reader)));\n\tpublic readonly lastActiveDiffItem = derivedObservableWithCache<VirtualizedViewItem | undefined>((reader, lastValue) => this.activeDiffItem.read(reader) ?? lastValue);\n\tpublic readonly activeControl = derived(this, reader => this.lastActiveDiffItem.read(reader)?.template.read(reader)?.editor);\n\n\tprivate readonly _contextKeyService = this._register(this._parentContextKeyService.createScoped(this._element));\n\tprivate readonly _instantiationService = this._parentInstantiationService.createChild(\n\t\tnew ServiceCollection([IContextKeyService, this._contextKeyService])\n\t);\n\n\tconstructor(\n\t\tprivate readonly _element: HTMLElement,\n\t\tprivate readonly _dimension: IObservable<Dimension | undefined>,\n\t\tprivate readonly _viewModel: IObservable<MultiDiffEditorViewModel | undefined>,\n\t\tprivate readonly _workbenchUIElementFactory: IWorkbenchUIElementFactory,\n\t\t@IContextKeyService private readonly _parentContextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _parentInstantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._contextKeyService.createKey(EditorContextKeys.inMultiDiffEditor.key, true);\n\n\t\tthis._register(autorunWithStore((reader, store) => {\n\t\t\tconst viewModel = this._viewModel.read(reader);\n\t\t\tif (viewModel && viewModel.contextKeys) {\n\t\t\t\tfor (const [key, value] of Object.entries(viewModel.contextKeys)) {\n\t\t\t\t\tconst contextKey = this._contextKeyService.createKey<ContextKeyValue>(key, undefined);\n\t\t\t\t\tcontextKey.set(value);\n\t\t\t\t\tstore.add(toDisposable(() => contextKey.reset()));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tconst ctxAllCollapsed = this._parentContextKeyService.createKey<boolean>(EditorContextKeys.multiDiffEditorAllCollapsed.key, false);\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst viewModel = this._viewModel.read(reader);\n\t\t\tif (viewModel) {\n\t\t\t\tconst allCollapsed = viewModel.items.read(reader).every(item => item.collapsed.read(reader));\n\t\t\t\tctxAllCollapsed.set(allCollapsed);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst lastActiveDiffItem = this.lastActiveDiffItem.read(reader);\n\t\t\ttransaction(tx => {\n\t\t\t\tthis._viewModel.read(reader)?.activeDiffItem.set(lastActiveDiffItem?.viewModel, tx);\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\t/** @description Update widget dimension */\n\t\t\tconst dimension = this._dimension.read(reader);\n\t\t\tthis._sizeObserver.observe(dimension);\n\t\t}));\n\n\t\tthis._elements.content.style.position = 'relative';\n\n\t\tthis._register(autorun((reader) => {\n\t\t\t/** @description Update scroll dimensions */\n\t\t\tconst height = this._sizeObserver.height.read(reader);\n\t\t\tthis._elements.root.style.height = `${height}px`;\n\t\t\tconst totalHeight = this._totalHeight.read(reader);\n\t\t\tthis._elements.content.style.height = `${totalHeight}px`;\n\n\t\t\tconst width = this._sizeObserver.width.read(reader);\n\n\t\t\tlet scrollWidth = width;\n\t\t\tconst viewItems = this._viewItems.read(reader);\n\t\t\tconst max = findFirstMaxBy(viewItems, i => i.maxScroll.read(reader).maxScroll);\n\t\t\tif (max) {\n\t\t\t\tconst maxScroll = max.maxScroll.read(reader);\n\t\t\t\tscrollWidth = width + maxScroll.maxScroll;\n\t\t\t}\n\n\t\t\tthis._scrollableElement.setScrollDimensions({\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tscrollHeight: totalHeight,\n\t\t\t\tscrollWidth,\n\t\t\t});\n\t\t}));\n\n\t\t_element.replaceChildren(this._scrollableElement.getDomNode());\n\t\tthis._register(toDisposable(() => {\n\t\t\t_element.replaceChildren();\n\t\t}));\n\n\t\tthis._register(this._register(autorun(reader => {\n\t\t\t/** @description Render all */\n\t\t\tglobalTransaction(tx => {\n\t\t\t\tthis.render(reader);\n\t\t\t});\n\t\t})));\n\t}\n\n\tpublic setScrollState(scrollState: { top?: number; left?: number }): void {\n\t\tthis._scrollableElement.setScrollPosition({ scrollLeft: scrollState.left, scrollTop: scrollState.top });\n\t}\n\n\tpublic reveal(resource: IMultiDiffResource, options?: RevealOptions): void {\n\t\tconst viewItems = this._viewItems.get();\n\t\tlet searchCallback: (item: VirtualizedViewItem) => boolean;\n\t\tif ('original' in resource) {\n\t\t\tsearchCallback = (item) => item.viewModel.originalUri?.toString() === resource.original.toString();\n\t\t} else {\n\t\t\tsearchCallback = (item) => item.viewModel.modifiedUri?.toString() === resource.modified.toString();\n\t\t}\n\t\tconst index = viewItems.findIndex(searchCallback);\n\t\tlet scrollTop = 0;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tscrollTop += viewItems[i].contentHeight.get() + this._spaceBetweenPx;\n\t\t}\n\t\tthis._scrollableElement.setScrollPosition({ scrollTop });\n\n\t\tconst diffEditor = viewItems[index].template.get()?.editor;\n\t\tconst editor = 'original' in resource ? diffEditor?.getOriginalEditor() : diffEditor?.getModifiedEditor();\n\t\tif (editor && options?.range) {\n\t\t\teditor.revealRangeInCenter(options.range);\n\t\t\thighlightRange(editor, options.range);\n\t\t}\n\t}\n\n\tpublic getViewState(): IMultiDiffEditorViewState {\n\t\treturn {\n\t\t\tscrollState: {\n\t\t\t\ttop: this.scrollTop.get(),\n\t\t\t\tleft: this.scrollLeft.get(),\n\t\t\t},\n\t\t\tdocStates: Object.fromEntries(this._viewItems.get().map(i => [i.getKey(), i.getViewState()])),\n\t\t};\n\t}\n\n\t/** This accounts for documents that are not loaded yet. */\n\tprivate _lastDocStates: IMultiDiffEditorViewState['docStates'] = {};\n\n\tpublic setViewState(viewState: IMultiDiffEditorViewState): void {\n\t\tthis.setScrollState(viewState.scrollState);\n\n\t\tthis._lastDocStates = viewState.docStates;\n\n\t\ttransaction(tx => {\n\t\t\t/** setViewState */\n\t\t\tif (viewState.docStates) {\n\t\t\t\tfor (const i of this._viewItems.get()) {\n\t\t\t\t\tconst state = viewState.docStates[i.getKey()];\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\ti.setViewState(state, tx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic tryGetCodeEditor(resource: URI): { diffEditor: IDiffEditor; editor: ICodeEditor } | undefined {\n\t\tconst item = this._viewItems.get().find(v =>\n\t\t\tv.viewModel.diffEditorViewModel.model.modified.uri.toString() === resource.toString()\n\t\t\t|| v.viewModel.diffEditorViewModel.model.original.uri.toString() === resource.toString()\n\t\t);\n\t\tconst editor = item?.template.get()?.editor;\n\t\tif (!editor) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (item.viewModel.diffEditorViewModel.model.modified.uri.toString() === resource.toString()) {\n\t\t\treturn { diffEditor: editor, editor: editor.getModifiedEditor() };\n\t\t} else {\n\t\t\treturn { diffEditor: editor, editor: editor.getOriginalEditor() };\n\t\t}\n\t}\n\n\tprivate render(reader: IReader | undefined) {\n\t\tconst scrollTop = this.scrollTop.read(reader);\n\t\tlet contentScrollOffsetToScrollOffset = 0;\n\t\tlet itemHeightSumBefore = 0;\n\t\tlet itemContentHeightSumBefore = 0;\n\t\tconst viewPortHeight = this._sizeObserver.height.read(reader);\n\t\tconst contentViewPort = OffsetRange.ofStartAndLength(scrollTop, viewPortHeight);\n\n\t\tconst width = this._sizeObserver.width.read(reader);\n\n\t\tfor (const v of this._viewItems.read(reader)) {\n\t\t\tconst itemContentHeight = v.contentHeight.read(reader);\n\t\t\tconst itemHeight = Math.min(itemContentHeight, viewPortHeight);\n\t\t\tconst itemRange = OffsetRange.ofStartAndLength(itemHeightSumBefore, itemHeight);\n\t\t\tconst itemContentRange = OffsetRange.ofStartAndLength(itemContentHeightSumBefore, itemContentHeight);\n\n\t\t\tif (itemContentRange.isBefore(contentViewPort)) {\n\t\t\t\tcontentScrollOffsetToScrollOffset -= itemContentHeight - itemHeight;\n\t\t\t\tv.hide();\n\t\t\t} else if (itemContentRange.isAfter(contentViewPort)) {\n\t\t\t\tv.hide();\n\t\t\t} else {\n\t\t\t\tconst scroll = Math.max(0, Math.min(contentViewPort.start - itemContentRange.start, itemContentHeight - itemHeight));\n\t\t\t\tcontentScrollOffsetToScrollOffset -= scroll;\n\t\t\t\tconst viewPort = OffsetRange.ofStartAndLength(scrollTop + contentScrollOffsetToScrollOffset, viewPortHeight);\n\t\t\t\tv.render(itemRange, scroll, width, viewPort);\n\t\t\t}\n\n\t\t\titemHeightSumBefore += itemHeight + this._spaceBetweenPx;\n\t\t\titemContentHeightSumBefore += itemContentHeight + this._spaceBetweenPx;\n\t\t}\n\n\t\tthis._elements.content.style.transform = `translateY(${-(scrollTop + contentScrollOffsetToScrollOffset)}px)`;\n\t}\n}\n\nfunction highlightRange(targetEditor: ICodeEditor, range: IRange) {\n\tconst modelNow = targetEditor.getModel();\n\tconst decorations = targetEditor.createDecorationsCollection([{ range, options: { description: 'symbol-navigate-action-highlight', className: 'symbolHighlight' } }]);\n\tsetTimeout(() => {\n\t\tif (targetEditor.getModel() === modelNow) {\n\t\t\tdecorations.clear();\n\t\t}\n\t}, 350);\n}\n\nexport interface IMultiDiffEditorViewState {\n\tscrollState: { top: number; left: number };\n\tdocStates?: Record<string, IMultiDiffDocState>;\n}\n\ninterface IMultiDiffDocState {\n\tcollapsed: boolean;\n\tselections?: ISelection[];\n}\n\nexport interface IMultiDiffEditorOptions extends ITextEditorOptions {\n\tviewState?: IMultiDiffEditorOptionsViewState;\n}\n\nexport interface IMultiDiffEditorOptionsViewState {\n\trevealData?: {\n\t\tresource: IMultiDiffResource;\n\t\trange?: IRange;\n\t};\n}\n\nexport type IMultiDiffResource = { original: URI } | { modified: URI };\n\nclass VirtualizedViewItem extends Disposable {\n\tprivate readonly _templateRef = this._register(disposableObservableValue<IReference<DiffEditorItemTemplate> | undefined>(this, undefined));\n\n\tpublic readonly contentHeight = derived(this, reader =>\n\t\tthis._templateRef.read(reader)?.object.contentHeight?.read(reader) ?? this.viewModel.lastTemplateData.read(reader).contentHeight\n\t);\n\n\tpublic readonly maxScroll = derived(this, reader => this._templateRef.read(reader)?.object.maxScroll.read(reader) ?? { maxScroll: 0, scrollWidth: 0 });\n\n\tpublic readonly template = derived(this, reader => this._templateRef.read(reader)?.object);\n\tprivate _isHidden = observableValue(this, false);\n\n\tconstructor(\n\t\tpublic readonly viewModel: DocumentDiffItemViewModel,\n\t\tprivate readonly _objectPool: ObjectPool<TemplateData, DiffEditorItemTemplate>,\n\t\tprivate readonly _scrollLeft: IObservable<number>,\n\t\tprivate readonly _deltaScrollVertical: (delta: number) => void,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst scrollLeft = this._scrollLeft.read(reader);\n\t\t\tthis._templateRef.read(reader)?.object.setScrollLeft(scrollLeft);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst ref = this._templateRef.read(reader);\n\t\t\tif (!ref) { return; }\n\t\t\tconst isHidden = this._isHidden.read(reader);\n\t\t\tif (!isHidden) { return; }\n\n\t\t\tconst isFocused = ref.object.isFocused.read(reader);\n\t\t\tif (isFocused) { return; }\n\n\t\t\tthis._clear();\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._clear();\n\t\tsuper.dispose();\n\t}\n\n\tpublic override toString(): string {\n\t\treturn `VirtualViewItem(${this.viewModel.entry.value!.modified?.uri.toString()})`;\n\t}\n\n\tpublic getKey(): string {\n\t\treturn this.viewModel.getKey();\n\t}\n\n\tpublic getViewState(): IMultiDiffDocState {\n\t\ttransaction(tx => {\n\t\t\tthis._updateTemplateData(tx);\n\t\t});\n\t\treturn {\n\t\t\tcollapsed: this.viewModel.collapsed.get(),\n\t\t\tselections: this.viewModel.lastTemplateData.get().selections,\n\t\t};\n\t}\n\n\tpublic setViewState(viewState: IMultiDiffDocState, tx: ITransaction): void {\n\t\tthis.viewModel.collapsed.set(viewState.collapsed, tx);\n\n\t\tthis._updateTemplateData(tx);\n\t\tconst data = this.viewModel.lastTemplateData.get();\n\t\tconst selections = viewState.selections?.map(Selection.liftSelection);\n\t\tthis.viewModel.lastTemplateData.set({\n\t\t\t...data,\n\t\t\tselections,\n\t\t}, tx);\n\t\tconst ref = this._templateRef.get();\n\t\tif (ref) {\n\t\t\tif (selections) {\n\t\t\t\tref.object.editor.setSelections(selections);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateTemplateData(tx: ITransaction): void {\n\t\tconst ref = this._templateRef.get();\n\t\tif (!ref) { return; }\n\t\tthis.viewModel.lastTemplateData.set({\n\t\t\tcontentHeight: ref.object.contentHeight.get(),\n\t\t\tselections: ref.object.editor.getSelections() ?? undefined,\n\t\t}, tx);\n\t}\n\n\tprivate _clear(): void {\n\t\tconst ref = this._templateRef.get();\n\t\tif (!ref) { return; }\n\t\ttransaction(tx => {\n\t\t\tthis._updateTemplateData(tx);\n\t\t\tref.object.hide();\n\t\t\tthis._templateRef.set(undefined, tx);\n\t\t});\n\t}\n\n\tpublic hide(): void {\n\t\tthis._isHidden.set(true, undefined);\n\t}\n\n\tpublic render(verticalSpace: OffsetRange, offset: number, width: number, viewPort: OffsetRange): void {\n\t\tthis._isHidden.set(false, undefined);\n\n\t\tlet ref = this._templateRef.get();\n\t\tif (!ref) {\n\t\t\tref = this._objectPool.getUnusedObj(new TemplateData(this.viewModel, this._deltaScrollVertical));\n\t\t\tthis._templateRef.set(ref, undefined);\n\n\t\t\tconst selections = this.viewModel.lastTemplateData.get().selections;\n\t\t\tif (selections) {\n\t\t\t\tref.object.editor.setSelections(selections);\n\t\t\t}\n\t\t}\n\t\tref.object.render(verticalSpace, width, offset, viewPort);\n\t}\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension, getWindow, h, scheduleAtNextAnimationFrame } from '../../../../base/browser/dom';\nimport { SmoothScrollableElement } from '../../../../base/browser/ui/scrollbar/scrollableElement';\nimport { findFirstMaxBy } from '../../../../base/common/arraysFind';\nimport { Disposable, IReference, toDisposable } from '../../../../base/common/lifecycle';\nimport { IObservable, IReader, autorun, autorunWithStore, derived, derivedObservableWithCache, derivedWithStore, observableFromEvent, observableValue } from '../../../../base/common/observable';\nimport { ITransaction, disposableObservableValue, globalTransaction, transaction } from '../../../../base/common/observableInternal/base';\nimport { Scrollable, ScrollbarVisibility } from '../../../../base/common/scrollable';\nimport { URI } from '../../../../base/common/uri';\nimport './style.css';\nimport { ICodeEditor } from '../../editorBrowser';\nimport { ObservableElementSizeObserver } from '../diffEditor/utils';\nimport { RevealOptions } from './multiDiffEditorWidget';\nimport { IWorkbenchUIElementFactory } from './workbenchUIElementFactory';\nimport { OffsetRange } from '../../../common/core/offsetRange';\nimport { IRange } from '../../../common/core/range';\nimport { ISelection, Selection } from '../../../common/core/selection';\nimport { IDiffEditor } from '../../../common/editorCommon';\nimport { EditorContextKeys } from '../../../common/editorContextKeys';\nimport { ContextKeyValue, IContextKeyService } from '../../../../platform/contextkey/common/contextkey';\nimport { ITextEditorOptions } from '../../../../platform/editor/common/editor';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection';\nimport { DiffEditorItemTemplate, TemplateData } from './diffEditorItemTemplate';\nimport { DocumentDiffItemViewModel, MultiDiffEditorViewModel } from './multiDiffEditorViewModel';\nimport { ObjectPool } from './objectPool';\n\nexport class MultiDiffEditorWidgetImpl extends Disposable {\n\tprivate readonly _elements = h('div.monaco-component.multiDiffEditor', [\n\t\th('div@content', {\n\t\t\tstyle: {\n\t\t\t\toverflow: 'hidden',\n\t\t\t}\n\t\t}),\n\t\th('div.monaco-editor@overflowWidgetsDomNode', {\n\t\t}),\n\t]);\n\n\tprivate readonly _sizeObserver = this._register(new ObservableElementSizeObserver(this._element, undefined));\n\n\tprivate readonly _objectPool = this._register(new ObjectPool<TemplateData, DiffEditorItemTemplate>((data) => {\n\t\tconst template = this._instantiationService.createInstance(\n\t\t\tDiffEditorItemTemplate,\n\t\t\tthis._elements.content,\n\t\t\tthis._elements.overflowWidgetsDomNode,\n\t\t\tthis._workbenchUIElementFactory\n\t\t);\n\t\ttemplate.setData(data);\n\t\treturn template;\n\t}));\n\n\tprivate readonly _scrollable = this._register(new Scrollable({\n\t\tforceIntegerValues: false,\n\t\tscheduleAtNextAnimationFrame: (cb) => scheduleAtNextAnimationFrame(getWindow(this._element), cb),\n\t\tsmoothScrollDuration: 100,\n\t}));\n\n\tprivate readonly _scrollableElement = this._register(new SmoothScrollableElement(this._elements.root, {\n\t\tvertical: ScrollbarVisibility.Auto,\n\t\thorizontal: ScrollbarVisibility.Auto,\n\t\tuseShadows: false,\n\t}, this._scrollable));\n\n\tpublic readonly scrollTop = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollTop */ this._scrollableElement.getScrollPosition().scrollTop);\n\tpublic readonly scrollLeft = observableFromEvent(this._scrollableElement.onScroll, () => /** @description scrollLeft */ this._scrollableElement.getScrollPosition().scrollLeft);\n\n\tprivate readonly _viewItems = derivedWithStore<readonly VirtualizedViewItem[]>(this,\n\t\t(reader, store) => {\n\t\t\tconst vm = this._viewModel.read(reader);\n\t\t\tif (!vm) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\tconst items = vm.items.read(reader);\n\t\t\treturn items.map(d => {\n\t\t\t\tconst item = store.add(new VirtualizedViewItem(d, this._objectPool, this.scrollLeft, delta => {\n\t\t\t\t\tthis._scrollableElement.setScrollPosition({ scrollTop: this._scrollableElement.getScrollPosition().scrollTop + delta });\n\t\t\t\t}));\n\t\t\t\tconst data = this._lastDocStates?.[item.getKey()];\n\t\t\t\tif (data) {\n\t\t\t\t\ttransaction(tx => {\n\t\t\t\t\t\titem.setViewState(data, tx);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\treturn item;\n\t\t\t});\n\t\t}\n\t);\n\n\tprivate readonly _spaceBetweenPx = 0;\n\n\tprivate readonly _totalHeight = this._viewItems.map(this, (items, reader) => items.reduce((r, i) => r + i.contentHeight.read(reader) + this._spaceBetweenPx, 0));\n\tpublic readonly activeDiffItem = derived(this, reader => this._viewItems.read(reader).find(i => i.template.read(reader)?.isFocused.read(reader)));\n\tpublic readonly lastActiveDiffItem = derivedObservableWithCache<VirtualizedViewItem | undefined>((reader, lastValue) => this.activeDiffItem.read(reader) ?? lastValue);\n\tpublic readonly activeControl = derived(this, reader => this.lastActiveDiffItem.read(reader)?.template.read(reader)?.editor);\n\n\tprivate readonly _contextKeyService = this._register(this._parentContextKeyService.createScoped(this._element));\n\tprivate readonly _instantiationService = this._parentInstantiationService.createChild(\n\t\tnew ServiceCollection([IContextKeyService, this._contextKeyService])\n\t);\n\n\tconstructor(\n\t\tprivate readonly _element: HTMLElement,\n\t\tprivate readonly _dimension: IObservable<Dimension | undefined>,\n\t\tprivate readonly _viewModel: IObservable<MultiDiffEditorViewModel | undefined>,\n\t\tprivate readonly _workbenchUIElementFactory: IWorkbenchUIElementFactory,\n\t\t@IContextKeyService private readonly _parentContextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _parentInstantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._contextKeyService.createKey(EditorContextKeys.inMultiDiffEditor.key, true);\n\n\t\tthis._register(autorunWithStore((reader, store) => {\n\t\t\tconst viewModel = this._viewModel.read(reader);\n\t\t\tif (viewModel && viewModel.contextKeys) {\n\t\t\t\tfor (const [key, value] of Object.entries(viewModel.contextKeys)) {\n\t\t\t\t\tconst contextKey = this._contextKeyService.createKey<ContextKeyValue>(key, undefined);\n\t\t\t\t\tcontextKey.set(value);\n\t\t\t\t\tstore.add(toDisposable(() => contextKey.reset()));\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\n\t\tconst ctxAllCollapsed = this._parentContextKeyService.createKey<boolean>(EditorContextKeys.multiDiffEditorAllCollapsed.key, false);\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst viewModel = this._viewModel.read(reader);\n\t\t\tif (viewModel) {\n\t\t\t\tconst allCollapsed = viewModel.items.read(reader).every(item => item.collapsed.read(reader));\n\t\t\t\tctxAllCollapsed.set(allCollapsed);\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst lastActiveDiffItem = this.lastActiveDiffItem.read(reader);\n\t\t\ttransaction(tx => {\n\t\t\t\tthis._viewModel.read(reader)?.activeDiffItem.set(lastActiveDiffItem?.viewModel, tx);\n\t\t\t});\n\t\t}));\n\n\t\tthis._register(autorun((reader) => {\n\t\t\t/** @description Update widget dimension */\n\t\t\tconst dimension = this._dimension.read(reader);\n\t\t\tthis._sizeObserver.observe(dimension);\n\t\t}));\n\n\t\tthis._elements.content.style.position = 'relative';\n\n\t\tthis._register(autorun((reader) => {\n\t\t\t/** @description Update scroll dimensions */\n\t\t\tconst height = this._sizeObserver.height.read(reader);\n\t\t\tthis._elements.root.style.height = `${height}px`;\n\t\t\tconst totalHeight = this._totalHeight.read(reader);\n\t\t\tthis._elements.content.style.height = `${totalHeight}px`;\n\n\t\t\tconst width = this._sizeObserver.width.read(reader);\n\n\t\t\tlet scrollWidth = width;\n\t\t\tconst viewItems = this._viewItems.read(reader);\n\t\t\tconst max = findFirstMaxBy(viewItems, i => i.maxScroll.read(reader).maxScroll);\n\t\t\tif (max) {\n\t\t\t\tconst maxScroll = max.maxScroll.read(reader);\n\t\t\t\tscrollWidth = width + maxScroll.maxScroll;\n\t\t\t}\n\n\t\t\tthis._scrollableElement.setScrollDimensions({\n\t\t\t\twidth: width,\n\t\t\t\theight: height,\n\t\t\t\tscrollHeight: totalHeight,\n\t\t\t\tscrollWidth,\n\t\t\t});\n\t\t}));\n\n\t\t_element.replaceChildren(this._scrollableElement.getDomNode());\n\t\tthis._register(toDisposable(() => {\n\t\t\t_element.replaceChildren();\n\t\t}));\n\n\t\tthis._register(this._register(autorun(reader => {\n\t\t\t/** @description Render all */\n\t\t\tglobalTransaction(tx => {\n\t\t\t\tthis.render(reader);\n\t\t\t});\n\t\t})));\n\t}\n\n\tpublic setScrollState(scrollState: { top?: number; left?: number }): void {\n\t\tthis._scrollableElement.setScrollPosition({ scrollLeft: scrollState.left, scrollTop: scrollState.top });\n\t}\n\n\tpublic reveal(resource: IMultiDiffResource, options?: RevealOptions): void {\n\t\tconst viewItems = this._viewItems.get();\n\t\tlet searchCallback: (item: VirtualizedViewItem) => boolean;\n\t\tif ('original' in resource) {\n\t\t\tsearchCallback = (item) => item.viewModel.originalUri?.toString() === resource.original.toString();\n\t\t} else {\n\t\t\tsearchCallback = (item) => item.viewModel.modifiedUri?.toString() === resource.modified.toString();\n\t\t}\n\t\tconst index = viewItems.findIndex(searchCallback);\n\t\tlet scrollTop = 0;\n\t\tfor (let i = 0; i < index; i++) {\n\t\t\tscrollTop += viewItems[i].contentHeight.get() + this._spaceBetweenPx;\n\t\t}\n\t\tthis._scrollableElement.setScrollPosition({ scrollTop });\n\n\t\tconst diffEditor = viewItems[index].template.get()?.editor;\n\t\tconst editor = 'original' in resource ? diffEditor?.getOriginalEditor() : diffEditor?.getModifiedEditor();\n\t\tif (editor && options?.range) {\n\t\t\teditor.revealRangeInCenter(options.range);\n\t\t\thighlightRange(editor, options.range);\n\t\t}\n\t}\n\n\tpublic getViewState(): IMultiDiffEditorViewState {\n\t\treturn {\n\t\t\tscrollState: {\n\t\t\t\ttop: this.scrollTop.get(),\n\t\t\t\tleft: this.scrollLeft.get(),\n\t\t\t},\n\t\t\tdocStates: Object.fromEntries(this._viewItems.get().map(i => [i.getKey(), i.getViewState()])),\n\t\t};\n\t}\n\n\t/** This accounts for documents that are not loaded yet. */\n\tprivate _lastDocStates: IMultiDiffEditorViewState['docStates'] = {};\n\n\tpublic setViewState(viewState: IMultiDiffEditorViewState): void {\n\t\tthis.setScrollState(viewState.scrollState);\n\n\t\tthis._lastDocStates = viewState.docStates;\n\n\t\ttransaction(tx => {\n\t\t\t/** setViewState */\n\t\t\tif (viewState.docStates) {\n\t\t\t\tfor (const i of this._viewItems.get()) {\n\t\t\t\t\tconst state = viewState.docStates[i.getKey()];\n\t\t\t\t\tif (state) {\n\t\t\t\t\t\ti.setViewState(state, tx);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic tryGetCodeEditor(resource: URI): { diffEditor: IDiffEditor; editor: ICodeEditor } | undefined {\n\t\tconst item = this._viewItems.get().find(v =>\n\t\t\tv.viewModel.diffEditorViewModel.model.modified.uri.toString() === resource.toString()\n\t\t\t|| v.viewModel.diffEditorViewModel.model.original.uri.toString() === resource.toString()\n\t\t);\n\t\tconst editor = item?.template.get()?.editor;\n\t\tif (!editor) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (item.viewModel.diffEditorViewModel.model.modified.uri.toString() === resource.toString()) {\n\t\t\treturn { diffEditor: editor, editor: editor.getModifiedEditor() };\n\t\t} else {\n\t\t\treturn { diffEditor: editor, editor: editor.getOriginalEditor() };\n\t\t}\n\t}\n\n\tprivate render(reader: IReader | undefined) {\n\t\tconst scrollTop = this.scrollTop.read(reader);\n\t\tlet contentScrollOffsetToScrollOffset = 0;\n\t\tlet itemHeightSumBefore = 0;\n\t\tlet itemContentHeightSumBefore = 0;\n\t\tconst viewPortHeight = this._sizeObserver.height.read(reader);\n\t\tconst contentViewPort = OffsetRange.ofStartAndLength(scrollTop, viewPortHeight);\n\n\t\tconst width = this._sizeObserver.width.read(reader);\n\n\t\tfor (const v of this._viewItems.read(reader)) {\n\t\t\tconst itemContentHeight = v.contentHeight.read(reader);\n\t\t\tconst itemHeight = Math.min(itemContentHeight, viewPortHeight);\n\t\t\tconst itemRange = OffsetRange.ofStartAndLength(itemHeightSumBefore, itemHeight);\n\t\t\tconst itemContentRange = OffsetRange.ofStartAndLength(itemContentHeightSumBefore, itemContentHeight);\n\n\t\t\tif (itemContentRange.isBefore(contentViewPort)) {\n\t\t\t\tcontentScrollOffsetToScrollOffset -= itemContentHeight - itemHeight;\n\t\t\t\tv.hide();\n\t\t\t} else if (itemContentRange.isAfter(contentViewPort)) {\n\t\t\t\tv.hide();\n\t\t\t} else {\n\t\t\t\tconst scroll = Math.max(0, Math.min(contentViewPort.start - itemContentRange.start, itemContentHeight - itemHeight));\n\t\t\t\tcontentScrollOffsetToScrollOffset -= scroll;\n\t\t\t\tconst viewPort = OffsetRange.ofStartAndLength(scrollTop + contentScrollOffsetToScrollOffset, viewPortHeight);\n\t\t\t\tv.render(itemRange, scroll, width, viewPort);\n\t\t\t}\n\n\t\t\titemHeightSumBefore += itemHeight + this._spaceBetweenPx;\n\t\t\titemContentHeightSumBefore += itemContentHeight + this._spaceBetweenPx;\n\t\t}\n\n\t\tthis._elements.content.style.transform = `translateY(${-(scrollTop + contentScrollOffsetToScrollOffset)}px)`;\n\t}\n}\n\nfunction highlightRange(targetEditor: ICodeEditor, range: IRange) {\n\tconst modelNow = targetEditor.getModel();\n\tconst decorations = targetEditor.createDecorationsCollection([{ range, options: { description: 'symbol-navigate-action-highlight', className: 'symbolHighlight' } }]);\n\tsetTimeout(() => {\n\t\tif (targetEditor.getModel() === modelNow) {\n\t\t\tdecorations.clear();\n\t\t}\n\t}, 350);\n}\n\nexport interface IMultiDiffEditorViewState {\n\tscrollState: { top: number; left: number };\n\tdocStates?: Record<string, IMultiDiffDocState>;\n}\n\ninterface IMultiDiffDocState {\n\tcollapsed: boolean;\n\tselections?: ISelection[];\n}\n\nexport interface IMultiDiffEditorOptions extends ITextEditorOptions {\n\tviewState?: IMultiDiffEditorOptionsViewState;\n}\n\nexport interface IMultiDiffEditorOptionsViewState {\n\trevealData?: {\n\t\tresource: IMultiDiffResource;\n\t\trange?: IRange;\n\t};\n}\n\nexport type IMultiDiffResource = { original: URI } | { modified: URI };\n\nclass VirtualizedViewItem extends Disposable {\n\tprivate readonly _templateRef = this._register(disposableObservableValue<IReference<DiffEditorItemTemplate> | undefined>(this, undefined));\n\n\tpublic readonly contentHeight = derived(this, reader =>\n\t\tthis._templateRef.read(reader)?.object.contentHeight?.read(reader) ?? this.viewModel.lastTemplateData.read(reader).contentHeight\n\t);\n\n\tpublic readonly maxScroll = derived(this, reader => this._templateRef.read(reader)?.object.maxScroll.read(reader) ?? { maxScroll: 0, scrollWidth: 0 });\n\n\tpublic readonly template = derived(this, reader => this._templateRef.read(reader)?.object);\n\tprivate _isHidden = observableValue(this, false);\n\n\tconstructor(\n\t\tpublic readonly viewModel: DocumentDiffItemViewModel,\n\t\tprivate readonly _objectPool: ObjectPool<TemplateData, DiffEditorItemTemplate>,\n\t\tprivate readonly _scrollLeft: IObservable<number>,\n\t\tprivate readonly _deltaScrollVertical: (delta: number) => void,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(autorun((reader) => {\n\t\t\tconst scrollLeft = this._scrollLeft.read(reader);\n\t\t\tthis._templateRef.read(reader)?.object.setScrollLeft(scrollLeft);\n\t\t}));\n\n\t\tthis._register(autorun(reader => {\n\t\t\tconst ref = this._templateRef.read(reader);\n\t\t\tif (!ref) { return; }\n\t\t\tconst isHidden = this._isHidden.read(reader);\n\t\t\tif (!isHidden) { return; }\n\n\t\t\tconst isFocused = ref.object.isFocused.read(reader);\n\t\t\tif (isFocused) { return; }\n\n\t\t\tthis._clear();\n\t\t}));\n\t}\n\n\toverride dispose(): void {\n\t\tthis._clear();\n\t\tsuper.dispose();\n\t}\n\n\tpublic override toString(): string {\n\t\treturn `VirtualViewItem(${this.viewModel.entry.value!.modified?.uri.toString()})`;\n\t}\n\n\tpublic getKey(): string {\n\t\treturn this.viewModel.getKey();\n\t}\n\n\tpublic getViewState(): IMultiDiffDocState {\n\t\ttransaction(tx => {\n\t\t\tthis._updateTemplateData(tx);\n\t\t});\n\t\treturn {\n\t\t\tcollapsed: this.viewModel.collapsed.get(),\n\t\t\tselections: this.viewModel.lastTemplateData.get().selections,\n\t\t};\n\t}\n\n\tpublic setViewState(viewState: IMultiDiffDocState, tx: ITransaction): void {\n\t\tthis.viewModel.collapsed.set(viewState.collapsed, tx);\n\n\t\tthis._updateTemplateData(tx);\n\t\tconst data = this.viewModel.lastTemplateData.get();\n\t\tconst selections = viewState.selections?.map(Selection.liftSelection);\n\t\tthis.viewModel.lastTemplateData.set({\n\t\t\t...data,\n\t\t\tselections,\n\t\t}, tx);\n\t\tconst ref = this._templateRef.get();\n\t\tif (ref) {\n\t\t\tif (selections) {\n\t\t\t\tref.object.editor.setSelections(selections);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateTemplateData(tx: ITransaction): void {\n\t\tconst ref = this._templateRef.get();\n\t\tif (!ref) { return; }\n\t\tthis.viewModel.lastTemplateData.set({\n\t\t\tcontentHeight: ref.object.contentHeight.get(),\n\t\t\tselections: ref.object.editor.getSelections() ?? undefined,\n\t\t}, tx);\n\t}\n\n\tprivate _clear(): void {\n\t\tconst ref = this._templateRef.get();\n\t\tif (!ref) { return; }\n\t\ttransaction(tx => {\n\t\t\tthis._updateTemplateData(tx);\n\t\t\tref.object.hide();\n\t\t\tthis._templateRef.set(undefined, tx);\n\t\t});\n\t}\n\n\tpublic hide(): void {\n\t\tthis._isHidden.set(true, undefined);\n\t}\n\n\tpublic render(verticalSpace: OffsetRange, offset: number, width: number, viewPort: OffsetRange): void {\n\t\tthis._isHidden.set(false, undefined);\n\n\t\tlet ref = this._templateRef.get();\n\t\tif (!ref) {\n\t\t\tref = this._objectPool.getUnusedObj(new TemplateData(this.viewModel, this._deltaScrollVertical));\n\t\t\tthis._templateRef.set(ref, undefined);\n\n\t\t\tconst selections = this.viewModel.lastTemplateData.get().selections;\n\t\t\tif (selections) {\n\t\t\t\tref.object.editor.setSelections(selections);\n\t\t\t}\n\t\t}\n\t\tref.object.render(verticalSpace, width, offset, viewPort);\n\t}\n}\n"]}