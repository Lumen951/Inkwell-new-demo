{"version":3,"sources":["vs/platform/history/browser/contextScopedHistoryWidget.ts"],"names":[],"mappings":"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","file":"contextScopedHistoryWidget.js","sourceRoot":"file:///workspaces/monaco-editor-core/out-editor-esm","sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IHistoryNavigationWidget } from '../../../base/browser/history';\nimport { IContextViewProvider } from '../../../base/browser/ui/contextview/contextview';\nimport { FindInput, IFindInputOptions } from '../../../base/browser/ui/findinput/findInput';\nimport { IReplaceInputOptions, ReplaceInput } from '../../../base/browser/ui/findinput/replaceInput';\nimport { HistoryInputBox, IHistoryInputOptions } from '../../../base/browser/ui/inputbox/inputBox';\nimport { KeyCode, KeyMod } from '../../../base/common/keyCodes';\nimport { ContextKeyExpr, IContextKey, IContextKeyService, RawContextKey } from '../../contextkey/common/contextkey';\nimport { KeybindingsRegistry, KeybindingWeight } from '../../keybinding/common/keybindingsRegistry';\nimport { localize } from '../../../nls';\nimport { DisposableStore, IDisposable, toDisposable } from '../../../base/common/lifecycle';\nimport { isActiveElement } from '../../../base/browser/dom';\n\nexport const historyNavigationVisible = new RawContextKey<boolean>('suggestWidgetVisible', false, localize('suggestWidgetVisible', \"Whether suggestion are visible\"));\n\nconst HistoryNavigationWidgetFocusContext = 'historyNavigationWidgetFocus';\nconst HistoryNavigationForwardsEnablementContext = 'historyNavigationForwardsEnabled';\nconst HistoryNavigationBackwardsEnablementContext = 'historyNavigationBackwardsEnabled';\n\nexport interface IHistoryNavigationContext extends IDisposable {\n\thistoryNavigationForwardsEnablement: IContextKey<boolean>;\n\thistoryNavigationBackwardsEnablement: IContextKey<boolean>;\n}\n\nlet lastFocusedWidget: IHistoryNavigationWidget | undefined = undefined;\nconst widgets: IHistoryNavigationWidget[] = [];\n\nexport function registerAndCreateHistoryNavigationContext(scopedContextKeyService: IContextKeyService, widget: IHistoryNavigationWidget): IHistoryNavigationContext {\n\tif (widgets.includes(widget)) {\n\t\tthrow new Error('Cannot register the same widget multiple times');\n\t}\n\n\twidgets.push(widget);\n\tconst disposableStore = new DisposableStore();\n\tconst historyNavigationWidgetFocus = new RawContextKey<boolean>(HistoryNavigationWidgetFocusContext, false).bindTo(scopedContextKeyService);\n\tconst historyNavigationForwardsEnablement = new RawContextKey<boolean>(HistoryNavigationForwardsEnablementContext, true).bindTo(scopedContextKeyService);\n\tconst historyNavigationBackwardsEnablement = new RawContextKey<boolean>(HistoryNavigationBackwardsEnablementContext, true).bindTo(scopedContextKeyService);\n\n\tconst onDidFocus = () => {\n\t\thistoryNavigationWidgetFocus.set(true);\n\t\tlastFocusedWidget = widget;\n\t};\n\n\tconst onDidBlur = () => {\n\t\thistoryNavigationWidgetFocus.set(false);\n\t\tif (lastFocusedWidget === widget) {\n\t\t\tlastFocusedWidget = undefined;\n\t\t}\n\t};\n\n\t// Check for currently being focused\n\tif (isActiveElement(widget.element)) {\n\t\tonDidFocus();\n\t}\n\n\tdisposableStore.add(widget.onDidFocus(() => onDidFocus()));\n\tdisposableStore.add(widget.onDidBlur(() => onDidBlur()));\n\tdisposableStore.add(toDisposable(() => {\n\t\twidgets.splice(widgets.indexOf(widget), 1);\n\t\tonDidBlur();\n\t}));\n\n\treturn {\n\t\thistoryNavigationForwardsEnablement,\n\t\thistoryNavigationBackwardsEnablement,\n\t\tdispose() {\n\t\t\tdisposableStore.dispose();\n\t\t}\n\t};\n}\n\nexport class ContextScopedHistoryInputBox extends HistoryInputBox {\n\n\tconstructor(container: HTMLElement, contextViewProvider: IContextViewProvider | undefined, options: IHistoryInputOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(container, contextViewProvider, options);\n\t\tconst scopedContextKeyService = this._register(contextKeyService.createScoped(this.element));\n\t\tthis._register(registerAndCreateHistoryNavigationContext(scopedContextKeyService, this));\n\t}\n\n}\n\nexport class ContextScopedFindInput extends FindInput {\n\n\tconstructor(container: HTMLElement | null, contextViewProvider: IContextViewProvider, options: IFindInputOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(container, contextViewProvider, options);\n\t\tconst scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));\n\t\tthis._register(registerAndCreateHistoryNavigationContext(scopedContextKeyService, this.inputBox));\n\t}\n}\n\nexport class ContextScopedReplaceInput extends ReplaceInput {\n\n\tconstructor(container: HTMLElement | null, contextViewProvider: IContextViewProvider | undefined, options: IReplaceInputOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService, showReplaceOptions: boolean = false\n\t) {\n\t\tsuper(container, contextViewProvider, showReplaceOptions, options);\n\t\tconst scopedContextKeyService = this._register(contextKeyService.createScoped(this.inputBox.element));\n\t\tthis._register(registerAndCreateHistoryNavigationContext(scopedContextKeyService, this.inputBox));\n\t}\n\n}\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'history.showPrevious',\n\tweight: KeybindingWeight.WorkbenchContrib,\n\twhen: ContextKeyExpr.and(\n\t\tContextKeyExpr.has(HistoryNavigationWidgetFocusContext),\n\t\tContextKeyExpr.equals(HistoryNavigationBackwardsEnablementContext, true),\n\t\tContextKeyExpr.not('isComposing'),\n\t\thistoryNavigationVisible.isEqualTo(false),\n\t),\n\tprimary: KeyCode.UpArrow,\n\tsecondary: [KeyMod.Alt | KeyCode.UpArrow],\n\thandler: (accessor) => {\n\t\tlastFocusedWidget?.showPreviousValue();\n\t}\n});\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: 'history.showNext',\n\tweight: KeybindingWeight.WorkbenchContrib,\n\twhen: ContextKeyExpr.and(\n\t\tContextKeyExpr.has(HistoryNavigationWidgetFocusContext),\n\t\tContextKeyExpr.equals(HistoryNavigationForwardsEnablementContext, true),\n\t\tContextKeyExpr.not('isComposing'),\n\t\thistoryNavigationVisible.isEqualTo(false),\n\t),\n\tprimary: KeyCode.DownArrow,\n\tsecondary: [KeyMod.Alt | KeyCode.DownArrow],\n\thandler: (accessor) => {\n\t\tlastFocusedWidget?.showNextValue();\n\t}\n});\n"]}